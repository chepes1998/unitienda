<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>POS Pro V28 Espacioso</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Firebase -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #f8fafc; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; overflow: hidden; }
        .scroller::-webkit-scrollbar { width: 4px; }
        .scroller::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .cart-panel { transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .cart-open { transform: translateY(0); }
        .cart-closed { transform: translateY(calc(100% - 70px)); }
        .fade-in { animation: fadeIn 0.2s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        /* FUERZA BRUTA CSS PARA INPUTS - MODIFICADO PARA SER M√ÅS GRANDE */
        .force-input-style {
            background-color: #ffffff !important;
            color: #000000 !important;
            -webkit-text-fill-color: #000000 !important;
            opacity: 1 !important;
            border: none !important; /* Sin borde para un look m√°s limpio */
            font-size: 18px !important; /* Letra m√°s grande */
            font-weight: bold !important;
            line-height: normal !important;
            padding: 0 15px 0 45px !important; /* Padding ajustado para el icono */
            border-radius: 12px !important;
            height: 55px !important; /* Altura aumentada para mejor tacto */
            width: 100% !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
            appearance: none !important;
            -webkit-appearance: none !important;
        }
        
        .force-input-style::placeholder {
            color: #94a3b8 !important;
            -webkit-text-fill-color: #94a3b8 !important;
            opacity: 1 !important;
        }
        
        /* Ocultar scrollbar horizontal en la barra de botones */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // --- 1. CONFIGURACI√ìN ---
        var firebaseConfig = {
            apiKey: "AIzaSyDSnbcmot5igqcTnkAln__sKJ7j0HnELA4",
            authDomain: "puntoventauni.firebaseapp.com",
            projectId: "puntoventauni",
            storageBucket: "puntoventauni.firebasestorage.app",
            messagingSenderId: "430191202374",
            appId: "1:430191202374:web:ccfa3edab8b1190f4afa47"
        };

        try { if (!firebase.apps.length) firebase.initializeApp(firebaseConfig); } catch(e) {}

        var db = firebase.firestore();
        var auth = firebase.auth();
        var APP_ID = "tienda_produccion_real_v1"; // Mismo ID para conservar datos
        var PRODUCTS_REF = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('products');
        var SALES_REF = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('sales');

        // --- 2. ICONOS ---
        var Icon = function(props) {
            var p={
                search:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",
                plus:"M12 4v16m8-8H4",
                trash:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-2.095-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16",
                close:"M6 18L18 6M6 6l12 12",
                edit:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z",
                settings:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z",
                chevronUp:"M5 15l7-7 7 7",
                chevronDown:"M19 9l-7 7-7-7",
                alert:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z",
                chart:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z",
                scissors:"M4.5 10a2.5 2.5 0 115 0 2.5 2.5 0 01-5 0zM17 10a2.5 2.5 0 115 0 2.5 2.5 0 01-5 0zM8.835 12.335L12 15.5l3.165-3.165M12 15.5V19.5",
                download:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4",
                xCircle:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z",
                card:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z",
                cash:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z",
                refresh:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15",
                check: "M5 13l4 4L19 7",
                money: "M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z",
                trending: "M13 7h8m0 0v8m0-8l-8 8-4-4-6 6",
                arrowRight: "M14 5l7 7m0 0l-7 7m7-7H3"
            };
            return <svg className={props.className || "w-6 h-6"} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d={p[props.name]} /></svg>;
        };

        var formatMoney = function(amount) { return '$' + parseFloat(amount).toFixed(2); };

        var getCatEmoji = function(cat) {
            if(cat === 'dulces') return 'üç¨';
            if(cat === 'granel') return 'üåæ';
            if(cat === 'abarrotes') return 'ü•´';
            return '';
        };

        var calculateClipNet = function(amount) {
            var commission = Math.round((amount * 0.036) * 100) / 100;
            var iva = Math.round((commission * 0.16) * 100) / 100;
            return amount - (commission + iva);
        };

        // --- TARJETA ---
        var ProductCard = function(props) {
            var p = props.product;
            var isAdmin = props.isAdmin;
            var isSFC = p.store === 'sfc';
            
            var colors = ['bg-blue-600', 'bg-violet-600', 'bg-emerald-500', 'bg-rose-500', 'bg-amber-500', 'bg-cyan-600', 'bg-indigo-600', 'bg-fuchsia-600'];
            var colorIndex = (p.name || "").length % colors.length;
            var bgClass = colors[colorIndex];
            if (p.stock <= 0 && !isAdmin) bgClass = 'bg-gray-400';
            var initials = (p.name || "??").substring(0, 2).toUpperCase();
            var emoji = !isSFC ? getCatEmoji(p.category) : '';

            return (
                <div onClick={function(){ if(isAdmin) props.onEdit(p); else props.onAdd(p); }} 
                     className={"relative flex flex-col bg-white rounded-lg shadow-sm overflow-hidden aspect-square cursor-pointer border border-gray-700 transition-transform " + (isAdmin ? "" : "active:scale-95")}>
                    {!isAdmin && props.qty > 0 && <div className="absolute top-1 right-1 w-5 h-5 bg-white text-gray-900 font-bold rounded-full flex items-center justify-center shadow-md z-10 text-xs border border-gray-300">{props.qty}</div>}
                    {isAdmin && (
                        <div className="absolute top-1 right-1 z-10 flex gap-1">
                            <button onClick={function(e){ e.stopPropagation(); props.onDelete(p); }} className="w-6 h-6 bg-white text-red-500 rounded-full flex items-center justify-center shadow-md border border-red-100"><Icon name="trash" className="w-3 h-3" /></button>
                            <div className="w-6 h-6 bg-white text-blue-600 rounded-full flex items-center justify-center shadow-md border border-blue-100"><Icon name="edit" className="w-3 h-3" /></div>
                        </div>
                    )}
                    <div className="absolute top-1 left-1 z-10 flex gap-1 filter drop-shadow-md">
                        <span className="text-sm">{isSFC ? 'ü¶Ü' : 'üçÅ'}</span>
                        {emoji && <span className="text-xs bg-white bg-opacity-90 rounded-full w-4 h-4 flex items-center justify-center shadow-sm">{emoji}</span>}
                    </div>
                    <div className={"flex-1 flex items-center justify-center relative " + bgClass}><span className="text-2xl font-black text-white opacity-90 tracking-tighter">{initials}</span></div>
                    <div className="p-1.5 flex flex-col justify-between h-12 bg-white">
                        <div className="text-[10px] font-bold text-gray-800 truncate leading-tight">{p.name}</div>
                        <div className="flex justify-between items-end">
                            <div className={"text-[9px] font-bold " + (p.stock <= 0 ? "text-red-500" : "text-gray-400")}>{p.stock}</div>
                            <span className="font-bold text-sm text-gray-900 leading-none">{formatMoney(p.price)}</span>
                        </div>
                    </div>
                </div>
            );
        };

        // --- M√ìDULO CALCULADORA DE GANANCIAS ---
        var ProfitCalculatorModal = function(props) {
            if (!props.isOpen) return null;
            var [cost, setCost] = React.useState("");
            var [units, setUnits] = React.useState("");
            var [price, setPrice] = React.useState("");

            var c = parseFloat(cost) || 0;
            var u = parseFloat(units) || 1;
            var p = parseFloat(price) || 0;

            var unitCost = c / u;
            var totalSales = p * u;
            var profit = totalSales - c;
            var margin = c > 0 ? (profit / c) * 100 : 0;

            return (
                <div className="fixed inset-0 z-[60] bg-black bg-opacity-60 p-4 flex items-center justify-center backdrop-blur-sm animate-fade-in">
                    <div className="bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl">
                        <div className="bg-purple-700 p-4 text-white flex justify-between items-center">
                            <h2 className="text-lg font-bold flex items-center gap-2"><Icon name="trending" /> Calculadora de Ganancia</h2>
                            <button onClick={props.onClose}><Icon name="close" /></button>
                        </div>
                        <div className="p-5 space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-xs font-bold text-gray-500 uppercase">Costo Paquete</label><input type="number" className="w-full p-2 border-b-2 border-purple-200 outline-none font-bold text-gray-800" placeholder="$0" value={cost} onChange={function(e){setCost(e.target.value)}} /></div>
                                <div><label className="text-xs font-bold text-gray-500 uppercase">Piezas</label><input type="number" className="w-full p-2 border-b-2 border-purple-200 outline-none font-bold text-gray-800" placeholder="0" value={units} onChange={function(e){setUnits(e.target.value)}} /></div>
                            </div>
                            <div><label className="text-xs font-bold text-gray-500 uppercase">Precio Venta (Unitario)</label><input type="number" className="w-full p-2 border-b-2 border-purple-500 outline-none font-black text-2xl text-purple-700" placeholder="$0" value={price} onChange={function(e){setPrice(e.target.value)}} /></div>
                            
                            <div className="bg-gray-50 rounded-xl p-4 border border-gray-100 space-y-2">
                                <div className="flex justify-between text-sm"><span className="text-gray-500">Costo por unidad:</span><span className="font-bold text-gray-700">{formatMoney(unitCost)}</span></div>
                                <div className="flex justify-between text-sm"><span className="text-gray-500">Venta Total:</span><span className="font-bold text-gray-700">{formatMoney(totalSales)}</span></div>
                                <div className="border-t border-gray-200 my-2"></div>
                                <div className="flex justify-between items-center">
                                    <span className="font-bold text-purple-700 uppercase">Ganancia Neta:</span>
                                    <span className="text-2xl font-black text-green-600">{formatMoney(profit)}</span>
                                </div>
                                <div className="text-center text-xs font-bold text-gray-400">Margen: {margin.toFixed(1)}%</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- M√ìDULO RETIROS ---
        var WithdrawalModal = function(props) {
            if (!props.isOpen) return null;
            var [amount, setAmount] = React.useState("");
            var val = parseFloat(amount) || 0;
            var toDeliver = val * 0.90; 
            var toCharge = val * 1.10;

            return (
                <div className="fixed inset-0 z-50 bg-black bg-opacity-60 p-4 flex items-center justify-center backdrop-blur-sm animate-fade-in">
                    <div className="bg-white w-full max-w-sm rounded-2xl overflow-hidden shadow-2xl">
                        <div className="bg-emerald-600 p-4 text-white flex justify-between items-center">
                            <h2 className="text-xl font-bold flex items-center gap-2"><Icon name="money" /> Retiros de Efectivo</h2>
                            <button onClick={props.onClose}><Icon name="close" /></button>
                        </div>
                        <div className="p-5">
                            <label className="text-sm font-bold text-gray-500 uppercase mb-2 block text-center">Monto Solicitado</label>
                            <input type="number" autoFocus className="w-full text-center text-4xl font-black text-gray-800 border-b-2 border-emerald-500 outline-none pb-2 mb-6" placeholder="$0" value={amount} onChange={function(e){ setAmount(e.target.value) }} />
                            <div className="space-y-4">
                                <div className="bg-blue-50 border border-blue-200 rounded-xl p-3">
                                    <div className="flex justify-between items-center mb-1"><span className="text-xs font-bold text-blue-500 uppercase">Cobras en Terminal</span><span className="text-xs font-bold text-emerald-600 uppercase">Entregas Efectivo</span></div>
                                    <div className="flex justify-between items-end"><span className="text-xl font-bold text-gray-800">{formatMoney(val)}</span><Icon name="arrowRight" className="text-gray-400 w-4 h-4"/><span className="text-3xl font-black text-emerald-600">{formatMoney(toDeliver)}</span></div>
                                    <div className="text-[10px] text-center text-blue-400 mt-1 font-medium">Ganancia: {formatMoney(val - toDeliver)}</div>
                                </div>
                                <div className="bg-orange-50 border border-orange-200 rounded-xl p-3">
                                    <div className="flex justify-between items-center mb-1"><span className="text-xs font-bold text-emerald-600 uppercase">Entregas Exacto</span><span className="text-xs font-bold text-orange-500 uppercase">Cobras en Terminal</span></div>
                                    <div className="flex justify-between items-end"><span className="text-xl font-bold text-gray-800">{formatMoney(val)}</span><Icon name="arrowRight" className="text-gray-400 w-4 h-4"/><span className="text-3xl font-black text-orange-600">{formatMoney(toCharge)}</span></div>
                                    <div className="text-[10px] text-center text-orange-400 mt-1 font-medium">Ganancia: {formatMoney(toCharge - val)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- REPORTES ---
        var ReportsModal = function(props) {
            if (!props.isOpen) return null;
            var [salesData, setSalesData] = React.useState({ globalTotal: 0, transferTotal: 0, cardTotal: 0, cardNetTotal: 0, sfcTotal: 0, sfcComm: 0, sfcItems: {}, hojaTotal: 0, hojaComm: 0, hojaItems: {} });
            var [confirmCutSFC, setConfirmCutSFC] = React.useState(false);
            var [confirmCutHoja, setConfirmCutHoja] = React.useState(false);

            React.useEffect(function() {
                var unsub = SALES_REF.onSnapshot(function(snap) {
                    var data = { globalTotal: 0, transferTotal: 0, cardTotal: 0, cardNetTotal: 0, sfcTotal: 0, sfcComm: 0, sfcItems: {}, hojaTotal: 0, hojaComm: 0, hojaItems: {} };
                    snap.forEach(function(doc) {
                        var sale = doc.data();
                        data.globalTotal += sale.total;
                        if (sale.method === 'transfer') data.transferTotal += sale.total;
                        if (sale.method === 'card') { data.cardTotal += sale.total; data.cardNetTotal += calculateClipNet(sale.total); }
                        if (sale.store === 'sfc') {
                            data.sfcTotal += sale.total;
                            if(sale.items) sale.items.forEach(function(item) {
                                data.sfcComm += (item.commission_unit || 0) * item.qty;
                                if(!data.sfcItems[item.name]) data.sfcItems[item.name] = { qty: 0, total: 0, category: item.category };
                                data.sfcItems[item.name].qty += item.qty;
                                data.sfcItems[item.name].total += item.price * item.qty;
                            });
                        } else if (sale.store === 'hoja') {
                            data.hojaTotal += sale.total;
                            if(sale.items) sale.items.forEach(function(item) {
                                data.hojaComm += (item.commission_unit || 0) * item.qty;
                                if(!data.hojaItems[item.name]) data.hojaItems[item.name] = { qty: 0, total: 0, category: item.category };
                                data.hojaItems[item.name].qty += item.qty;
                                data.hojaItems[item.name].total += item.price * item.qty;
                            });
                        }
                    });
                    setSalesData(data);
                });
                return function() { unsub(); };
            }, []);

            var executeCut = function(storeName) {
                SALES_REF.where('store', '==', storeName).get().then(function(snap) {
                    var batch = db.batch();
                    snap.forEach(function(doc) { batch.delete(doc.ref); });
                    return batch.commit();
                }).then(function() {
                    if(storeName==='sfc') setConfirmCutSFC(false); else setConfirmCutHoja(false);
                    props.onToast("Corte Realizado ‚úÖ");
                }).catch(function(e) { alert("Error: " + e.message); });
            };

            var downloadReport = function(storeName) {
                var isSFC = storeName === 'sfc';
                var itemsMap = isSFC ? salesData.sfcItems : salesData.hojaItems;
                var total = isSFC ? salesData.sfcTotal : salesData.hojaTotal;
                var comm = isSFC ? salesData.sfcComm : salesData.hojaComm;
                var title = isSFC ? "REPORTE SFC" : "REPORTE HOJA";
                var date = new Date().toLocaleString();
                var content = "================================\n      " + title + "\n================================\nFecha: " + date + "\n\nPRODUCTOS VENDIDOS:\n";
                if(Object.keys(itemsMap).length === 0) content += "(Sin ventas registradas)\n";
                else Object.entries(itemsMap).forEach(function(entry) { content += (isSFC?"":getCatEmoji(entry[1].category)) + " " + entry[0] + ": " + entry[1].qty + " pz | " + formatMoney(entry[1].total) + "\n"; });
                content += "\n--------------------------------\nTOTAL VENDIDO: " + formatMoney(total) + "\nCOMISI√ìN:      " + formatMoney(comm) + "\n================================\n";
                var blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a'); a.href = url; a.download = "Corte_" + (isSFC ? "SFC" : "Hoja") + "_" + new Date().toISOString().slice(0,10) + ".txt";
                document.body.appendChild(a); a.click(); document.body.removeChild(a);
            };

            return (
                <div className="fixed inset-0 z-50 bg-gray-100 flex flex-col animate-fade-in">
                    <div className="bg-slate-900 p-4 text-white flex justify-between items-center shadow-lg"><h2 className="text-xl font-bold flex items-center gap-2"><Icon name="chart" /> Cortes de Caja</h2><button onClick={props.onClose}><Icon name="close" /></button></div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-6">
                        <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 text-center">
                            <div className="text-xs font-bold text-gray-400 uppercase tracking-wider">Caja Total (Global)</div>
                            <div className="text-3xl font-black text-slate-800 mt-1">{formatMoney(salesData.globalTotal)}</div>
                            <div className="mt-3 pt-3 border-t border-gray-100 grid grid-cols-2 gap-2 text-xs">
                                <div className="bg-indigo-50 p-2 rounded-lg text-indigo-700 font-bold flex flex-col items-center"><span className="uppercase text-[10px] opacity-70">Transferencias</span><span className="text-sm">{formatMoney(salesData.transferTotal)}</span></div>
                                <div className="bg-orange-50 p-2 rounded-lg text-orange-700 font-bold flex flex-col items-center border border-orange-100"><span className="uppercase text-[10px] opacity-70 flex items-center gap-1"><Icon name="card" className="w-3 h-3"/> Clip (A Depositar)</span><span className="text-lg">{formatMoney(salesData.cardNetTotal)}</span></div>
                            </div>
                        </div>
                        <div className="bg-white rounded-2xl shadow-md border-l-4 border-blue-600 overflow-hidden">
                            <div className="bg-blue-50 p-4 border-b border-blue-100 flex justify-between items-center"><h3 className="font-bold text-blue-800 flex items-center gap-2 text-lg">ü¶Ü SFC</h3><div className="text-right"><div className="text-xs text-blue-600 font-bold uppercase">Venta</div><div className="font-black text-xl text-blue-900">{formatMoney(salesData.sfcTotal)}</div></div></div>
                            <div className="p-4">
                                <div className="flex justify-between items-center mb-4 bg-blue-100 p-3 rounded-xl"><span className="font-bold text-blue-700 text-sm">Comisi√≥n:</span><span className="font-black text-lg text-blue-800">{formatMoney(salesData.sfcComm)}</span></div>
                                <ul className="text-sm space-y-1 mb-4 h-32 overflow-y-auto bg-gray-50 p-2 rounded">{Object.keys(salesData.sfcItems).length === 0 ? <li className="text-gray-400 italic text-xs">Caja en 0.00</li> : Object.entries(salesData.sfcItems).map(function(entry) { return <li key={entry[0]} className="flex justify-between border-b border-gray-200 py-1 text-slate-800"><span>{entry[0]}</span><span className="font-bold text-slate-900">{entry[1].qty} pz - {formatMoney(entry[1].total)}</span></li> }) }</ul>
                                <div className="flex gap-2">
                                    <button onClick={function(){ downloadReport('sfc') }} className="flex-1 bg-green-600 text-white font-bold py-3 rounded-lg shadow active:scale-95 flex items-center justify-center gap-2"><Icon name="download" /> TXT</button>
                                    {confirmCutSFC ? <button onClick={function(){ executeCut('sfc') }} className="flex-1 bg-red-600 text-white font-bold py-3 rounded-lg shadow animate-pulse">¬øCONFIRMAR?</button> : <button onClick={function(){ setConfirmCutSFC(true) }} className="flex-1 bg-blue-600 text-white font-bold py-3 rounded-lg shadow flex items-center justify-center gap-2 active:scale-95"><Icon name="scissors" /> CERRAR</button>}
                                </div>
                            </div>
                        </div>
                        <div className="bg-white rounded-2xl shadow-md border-l-4 border-orange-500 overflow-hidden">
                            <div className="bg-orange-50 p-4 border-b border-orange-100 flex justify-between items-center"><h3 className="font-bold text-orange-800 flex items-center gap-2 text-lg">üçÅ Hoja</h3><div className="text-right"><div className="text-xs text-orange-600 font-bold uppercase">Venta</div><div className="font-black text-xl text-orange-900">{formatMoney(salesData.hojaTotal)}</div></div></div>
                            <div className="p-4">
                                <div className="flex justify-between items-center mb-4 bg-orange-100 p-3 rounded-xl"><span className="font-bold text-orange-700 text-sm">Comisi√≥n:</span><span className="font-black text-lg text-orange-800">{formatMoney(salesData.hojaComm)}</span></div>
                                <ul className="text-sm space-y-1 mb-4 h-32 overflow-y-auto bg-gray-50 p-2 rounded">{Object.keys(salesData.hojaItems).length === 0 ? <li className="text-gray-400 italic text-xs">Caja en 0.00</li> : Object.entries(salesData.hojaItems).map(function(entry) { return <li key={entry[0]} className="flex justify-between border-b border-gray-200 py-1 text-slate-800"><span>{getCatEmoji(entry[1].category)} {entry[0]}</span><span className="font-bold text-slate-900">{entry[1].qty} pz - {formatMoney(entry[1].total)}</span></li> }) }</ul>
                                <div className="flex gap-2">
                                    <button onClick={function(){ downloadReport('hoja') }} className="flex-1 bg-green-600 text-white font-bold py-3 rounded-lg shadow active:scale-95 flex items-center justify-center gap-2"><Icon name="download" /> TXT</button>
                                    {confirmCutHoja ? <button onClick={function(){ executeCut('hoja') }} className="flex-1 bg-red-600 text-white font-bold py-3 rounded-lg shadow animate-pulse">¬øCONFIRMAR?</button> : <button onClick={function(){ setConfirmCutHoja(true) }} className="flex-1 bg-orange-600 text-white font-bold py-3 rounded-lg shadow flex items-center justify-center gap-2 active:scale-95"><Icon name="scissors" /> CERRAR</button>}
                                </div>
                            </div>
                        </div>
                        <div className="h-10"></div>
                    </div>
                </div>
            );
        };

        // --- MODALES AUXILIARES ---
        var ConfirmModal = function(props) {
            if (!props.isOpen) return null;
            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-70 p-4 fade-in backdrop-blur-sm">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-xs overflow-hidden p-6 text-center">
                        <div className="w-14 h-14 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500"><Icon name="alert" className="w-8 h-8" /></div>
                        <h3 className="text-lg font-bold text-gray-800 mb-2">¬øEliminar Producto?</h3>
                        <p className="text-sm text-gray-500 mb-6">Se borrar√° "{props.productName}" permanentemente.</p>
                        <div className="flex gap-3">
                            <button onClick={props.onClose} className="flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold active:scale-95">Cancelar</button>
                            <button onClick={props.onConfirm} className="flex-1 py-3 bg-red-500 text-white rounded-xl font-bold shadow-lg active:scale-95">S√≠, Borrar</button>
                        </div>
                    </div>
                </div>
            );
        };

        var ProductModal = function(props) {
            if (!props.isOpen) return null;
            var editMode = !!props.productToEdit;
            var initialData = props.productToEdit || { name: "", price: "", stock: "", store: "sfc", category: "abarrotes" };
            var [form, setForm] = React.useState({ name: initialData.name, price: initialData.price, stock: initialData.stock, store: initialData.store, category: initialData.category || "abarrotes" });
            var [saving, setSaving] = React.useState(false);
            var handleChange = function(f, v) { setForm(Object.assign({}, form, { [f]: v })); };
            var handleSubmit = function(e) {
                e.preventDefault();
                if(!form.name || form.price === "" || form.stock === "") return;
                setSaving(true);
                props.onSave({
                    name: form.name, price: parseFloat(form.price), stock: parseInt(form.stock), store: form.store,
                    category: form.store === 'hoja' ? form.category : null, updated_at: new Date().toISOString()
                }, props.productToEdit ? props.productToEdit.id : null, function() { setSaving(false); });
            };
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4 backdrop-filter backdrop-blur-sm">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden fade-in">
                        <div className={"p-4 flex justify-between items-center text-white " + (editMode ? "bg-indigo-600" : "bg-slate-900")}>
                            <h3 className="font-bold">{editMode ? "Editar" : "Nuevo"}</h3>
                            <button onClick={props.onClose}><Icon name="close" /></button>
                        </div>
                        <form onSubmit={handleSubmit} className="p-5 space-y-4">
                            <div><label className="text-xs font-bold text-gray-500 uppercase">Nombre</label><input value={form.name} onChange={function(e){handleChange('name',e.target.value)}} className="w-full p-3 bg-gray-100 rounded-lg font-bold outline-none text-gray-900" placeholder="Nombre" /></div>
                            <div className="flex gap-3">
                                <div className="flex-1"><label className="text-xs font-bold text-gray-500 uppercase">Precio</label><input type="number" value={form.price} onChange={function(e){handleChange('price',e.target.value)}} className="w-full p-3 bg-gray-100 rounded-lg font-bold outline-none text-gray-900" placeholder="$" /></div>
                                <div className="flex-1"><label className="text-xs font-bold text-gray-500 uppercase">Stock</label><input type="number" value={form.stock} onChange={function(e){handleChange('stock',e.target.value)}} className="w-full p-3 bg-gray-100 rounded-lg font-bold outline-none text-gray-900" placeholder="#" /></div>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-gray-500 uppercase mb-2 block">Tienda:</label>
                                <div className="flex gap-3 mb-3">
                                    <div onClick={function(){handleChange('store','sfc')}} className={"flex-1 p-3 rounded-lg border-2 cursor-pointer text-center font-bold " + (form.store==='sfc'?'border-blue-500 bg-blue-50 text-blue-700':'border-gray-200 text-gray-400')}>ü¶Ü SFC <div className="text-[9px] font-normal">Comisi√≥n $1</div></div>
                                    <div onClick={function(){handleChange('store','hoja')}} className={"flex-1 p-3 rounded-lg border-2 cursor-pointer text-center font-bold " + (form.store==='hoja'?'border-orange-500 bg-orange-50 text-orange-700':'border-gray-200 text-gray-400')}>üçÅ Hoja</div>
                                </div>
                                {form.store === 'hoja' && <div className="space-y-2 mt-3 animate-fade-in"><label className="text-xs font-bold text-orange-600 uppercase block">Categor√≠a Hoja:</label><div className="grid grid-cols-1 gap-2"><div onClick={function(){handleChange('category','abarrotes')}} className={"p-3 rounded-lg border cursor-pointer flex justify-between items-center " + (form.category==='abarrotes'?'bg-orange-100 border-orange-500 text-orange-900':'border-gray-200 text-gray-500')}><span className="font-bold">ü•´ Abarrotes</span><span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded font-bold">Ganancia: $1.00</span></div><div onClick={function(){handleChange('category','granel')}} className={"p-3 rounded-lg border cursor-pointer flex justify-between items-center " + (form.category==='granel'?'bg-orange-100 border-orange-500 text-orange-900':'border-gray-200 text-gray-500')}><span className="font-bold">üåæ A Granel</span><span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded font-bold">Ganancia: $0.50</span></div><div onClick={function(){handleChange('category','dulces')}} className={"p-3 rounded-lg border cursor-pointer flex justify-between items-center " + (form.category==='dulces'?'bg-orange-100 border-orange-500 text-orange-900':'border-gray-200 text-gray-500')}><span className="font-bold">üç¨ Dulces</span><span className="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded font-bold">Ganancia: $0.00</span></div></div></div>}
                            </div>
                            <button type="submit" disabled={saving} className={"w-full text-white font-bold p-4 rounded-xl shadow-lg " + (saving ? "bg-gray-400" : (editMode ? "bg-indigo-600" : "bg-slate-900"))}>{saving ? "Guardando..." : "Guardar"}</button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- APP ---
        var App = function() {
            var [products, setProducts] = React.useState([]);
            var [cart, setCart] = React.useState([]);
            var [search, setSearch] = React.useState("");
            var [payAmount, setPayAmount] = React.useState("");
            
            var [modalOpen, setModalOpen] = React.useState(false);
            var [reportsOpen, setReportsOpen] = React.useState(false);
            var [withdrawalOpen, setWithdrawalOpen] = React.useState(false);
            var [profitCalcOpen, setProfitCalcOpen] = React.useState(false); // NEW
            var [productToEdit, setProductToEdit] = React.useState(null);
            var [deleteData, setDeleteData] = React.useState(null);
            var [isAdminMode, setIsAdminMode] = React.useState(false);
            var [isCartOpen, setIsCartOpen] = React.useState(false);
            var [loading, setLoading] = React.useState(true);
            var [paymentMethod, setPaymentMethod] = React.useState('cash');
            var [toast, setToast] = React.useState(null);

            React.useEffect(function() {
                auth.onAuthStateChanged(function(u) {
                    if (u) {
                        PRODUCTS_REF.onSnapshot(function(snap) {
                            var items = []; snap.forEach(function(d){ items.push(Object.assign({id:d.id},d.data())) });
                            items.sort(function(a,b){ return (a.name||'').localeCompare(b.name||'') });
                            setProducts(items); setLoading(false);
                        });
                    } else { auth.signInAnonymously(); }
                });
            }, []);

            React.useEffect(function(){ if(toast) setTimeout(function(){setToast(null)}, 2000) }, [toast]);

            var addToCart = function(p) {
                if(isAdminMode) return;
                var exist = cart.find(function(x){ return x.id === p.id });
                if(exist) setCart(cart.map(function(x){ return x.id===p.id ? Object.assign({},x,{qty:x.qty+1}) : x }));
                else setCart([].concat(cart, [Object.assign({}, p, {qty:1})]));
            };

            var removeFromCart = function(id) { setCart(cart.filter(function(x){ return x.id !== id })); };

            var handleSave = function(data, id, cb) {
                var p = id ? PRODUCTS_REF.doc(id).update(data) : PRODUCTS_REF.add(Object.assign(data, {date_added:new Date().toISOString()}));
                p.then(function(){ setModalOpen(false); setProductToEdit(null); if(cb)cb(); }).catch(function(e){ alert(e.message); if(cb)cb(); });
            };

            var confirmDelete = function() {
                if(deleteData) PRODUCTS_REF.doc(deleteData.id).delete().then(function(){ setDeleteData(null); });
            };

            var handleCheckout = function() {
                if(!cart.length) return;
                var batch = db.batch();
                var sfcItems = cart.filter(function(i){ return i.store==='sfc' });
                var hojaItems = cart.filter(function(i){ return i.store==='hoja' });

                if(sfcItems.length > 0) {
                    var total = sfcItems.reduce(function(a,i){ return a+(i.price*i.qty) }, 0);
                    var items = sfcItems.map(function(i){ return Object.assign({}, i, {commission_unit:1.00}) });
                    batch.set(SALES_REF.doc(), { store: 'sfc', items: items, total: total, method: paymentMethod, date: new Date().toISOString() });
                }

                if(hojaItems.length > 0) {
                    var total = hojaItems.reduce(function(a,i){ return a+(i.price*i.qty) }, 0);
                    var items = hojaItems.map(function(i){ return Object.assign({}, i, {commission_unit:(i.category==='granel'?0.5:(i.category==='dulces'?0:1))}) });
                    batch.set(SALES_REF.doc(), { store: 'hoja', items: items, total: total, method: paymentMethod, date: new Date().toISOString() });
                }

                cart.forEach(function(i){ batch.update(PRODUCTS_REF.doc(i.id), {stock: i.stock - i.qty}); });
                batch.commit().then(function(){ 
                    setCart([]); setPayAmount(""); setPaymentMethod('cash'); setIsCartOpen(false); 
                    setToast("¬°Venta Exitosa! üí∏");
                }).catch(function(e) { alert("Error: " + e.message); });
            };

            var filtered = products.filter(function(p){ return p.name && p.name.toLowerCase().includes(search.toLowerCase()) });
            var total = cart.reduce(function(a,i){ return a+(i.price*i.qty) },0);
            var change = 0; if (paymentMethod === 'cash') change = payAmount ? parseFloat(payAmount) - total : 0; else change = 0;
            var clipNet = paymentMethod === 'card' ? calculateClipNet(total) : 0;
            var totalItems = cart.reduce(function(a,b){ return a+b.qty },0);

            if(loading) return <div className="h-screen flex items-center justify-center font-bold text-gray-500">Cargando...</div>;

            return (
                <div className="flex h-screen overflow-hidden bg-slate-900 text-slate-100 font-sans flex-col md:flex-row">
                    {toast && (
                        <div className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-xl z-[70] animate-fade-in flex items-center gap-2 border border-slate-700">
                            <Icon name="check" className="w-5 h-5 text-green-400" />
                            <span className="font-bold text-sm">{toast}</span>
                        </div>
                    )}

                    <div className="flex-1 flex flex-col h-full relative w-full bg-slate-900">
                        <div className={"shadow-md z-10 flex flex-col sticky top-0 p-3 transition-colors " + (isAdminMode ? "bg-slate-800" : "bg-gradient-to-br from-red-900 to-black")}>
                            
                            {/* NUEVO DISE√ëO DE HEADER: BARRA ARRIBA, ICONOS ABAJO */}
                            <div className="flex flex-col gap-3">
                                
                                {/* FILA 1: BUSCADOR ESPACIOSO */}
                                <div className="w-full relative">
                                    <span className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 z-10 pointer-events-none"><Icon name="search" className="w-6 h-6" /></span>
                                    <input 
                                        type="text" 
                                        className="force-input-style"
                                        placeholder="Buscar producto..." 
                                        value={search} 
                                        onChange={function(e){setSearch(e.target.value)}} 
                                        autoComplete="off"
                                        autoCorrect="off"
                                        spellCheck="false"
                                    />
                                    {search && <button onClick={function(){setSearch('')}} className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 p-2"><Icon name="close" className="w-5 h-5" /></button>}
                                </div>

                                {/* FILA 2: BOTONES DE ACCI√ìN (SCROLL HORIZONTAL SI ES NECESARIO) */}
                                <div className="flex justify-between items-center gap-2 overflow-x-auto no-scrollbar pb-1">
                                    <div className="flex gap-2">
                                        <button onClick={function(){window.location.reload()}} className="text-white/50 p-2 hover:text-white rounded-lg hover:bg-white/10"><Icon name="refresh" /></button>
                                        <button onClick={function(){setReportsOpen(true)}} className={"w-11 h-11 rounded-xl flex items-center justify-center shadow-lg transition-all " + (isAdminMode ? "bg-slate-700 text-white" : "bg-white/10 text-white hover:bg-white/20")}><Icon name="chart" /></button>
                                        <button onClick={function(){setProfitCalcOpen(true)}} className={"w-11 h-11 rounded-xl flex items-center justify-center shadow-lg transition-all " + (isAdminMode ? "bg-slate-700 text-white" : "bg-white/10 text-white hover:bg-white/20")}><Icon name="trending" className="text-purple-400" /></button>
                                        <button onClick={function(){setWithdrawalOpen(true)}} className={"w-11 h-11 rounded-xl flex items-center justify-center shadow-lg transition-all " + (isAdminMode ? "bg-slate-700 text-white" : "bg-white/10 text-white hover:bg-white/20")}><Icon name="money" className="text-green-400"/></button>
                                    </div>
                                    <div className="flex gap-2 items-center">
                                        <div className={"text-xs font-bold text-right leading-tight " + (isAdminMode ? "text-yellow-400" : "text-white/70")}>
                                            <div className="opacity-70">{isAdminMode ? "ADMIN" : "VENTA"}</div>
                                            <div>{products.length}</div>
                                        </div>
                                        <button onClick={function(){setIsAdminMode(!isAdminMode)}} className={"w-11 h-11 rounded-xl flex items-center justify-center shadow-lg transition-all border-2 " + (isAdminMode ? "bg-yellow-500 border-yellow-400 text-slate-900" : "bg-transparent border-white/20 text-yellow-400 hover:bg-white/10")}><Icon name="settings" /></button>
                                        {isAdminMode && <button onClick={function(){setProductToEdit(null);setModalOpen(true)}} className="bg-blue-600 text-white w-11 h-11 rounded-xl flex items-center justify-center shadow-lg animate-fade-in"><Icon name="plus" /></button>}
                                    </div>
                                </div>
                            
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-3 pb-32 scroller bg-gradient-to-b from-red-900 via-slate-900 to-black">
                            <div className="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2">
                                {filtered.map(function(p){ 
                                    var q = (cart.find(function(x){return x.id===p.id}) || {}).qty || 0;
                                    return <ProductCard key={p.id} product={p} qty={q} isAdmin={isAdminMode} onAdd={addToCart} onEdit={function(x){setProductToEdit(x);setModalOpen(true)}} onDelete={setDeleteData} /> 
                                })}
                            </div>
                            {filtered.length===0 && <div className="text-center mt-10 text-gray-400">Sin resultados</div>}
                        </div>
                    </div>
                    {!isAdminMode && (
                        <div className={"cart-panel bg-white shadow-[0_-5px_25px_rgba(0,0,0,0.15)] z-20 flex flex-col fixed bottom-0 left-0 right-0 rounded-t-2xl border-t border-gray-100 md:relative md:w-96 md:h-full md:rounded-none md:shadow-none md:border-l md:border-t-0 md:translate-y-0 " + (isCartOpen ? "cart-open h-[85vh]" : "cart-closed h-auto")}>
                            <div onClick={function(){setIsCartOpen(!isCartOpen)}} className="w-full bg-white p-3 cursor-pointer md:cursor-default rounded-t-2xl flex items-center justify-between border-b border-gray-50 hover:bg-gray-50 transition-colors h-[70px]">
                                <div className="flex items-center gap-3"><div className={"w-10 h-10 rounded-full flex items-center justify-center font-bold text-white transition-all " + (cart.length>0?"bg-blue-600 scale-100":"bg-gray-300 scale-0")}>{totalItems}</div><div className="flex flex-col"><span className="text-xs font-bold text-gray-400 uppercase">Total a Pagar</span><span className="text-2xl font-black text-slate-800 leading-none">{formatMoney(total)}</span></div></div>
                                <div className="text-gray-400 md:hidden">{isCartOpen ? <Icon name="chevronDown" /> : <Icon name="chevronUp" />}</div>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 bg-gray-50 md:bg-white scroller text-slate-800">
                                <h3 className="text-sm font-bold text-gray-500 mb-3 uppercase">Detalle de Compra</h3>
                                {cart.length===0 ? <p className="text-gray-400 text-center py-10">Agrega productos.</p> : 
                                    cart.map(function(item){
                                        var emoji = !item.store==='sfc' ? getCatEmoji(item.category) : '';
                                        return <div key={item.id} className="flex justify-between items-center bg-white p-2 mb-2 rounded-lg shadow-sm border border-gray-100"><div><div className="font-bold text-slate-800 text-sm">{emoji} {item.name}</div><div className="text-xs text-gray-500">{formatMoney(item.price)} x {item.qty}</div></div><div className="flex items-center gap-3"><span className="font-bold text-slate-900">{formatMoney(item.price*item.qty)}</span><button onClick={function(){removeFromCart(item.id)}} className="p-2 text-red-500 bg-red-50 rounded-lg"><Icon name="trash" className="w-4 h-4" /></button></div></div>
                                    })
                                }
                            </div>
                            <div className="p-4 bg-white border-t border-gray-100 text-slate-800" style={{paddingBottom: 'max(1rem, env(safe-area-inset-bottom))'}}>
                                <div className="grid grid-cols-2 gap-2 mb-3">
                                    <button onClick={function(){ setPaymentMethod('cash'); setPayAmount(''); }} className={"py-2 rounded-lg text-sm font-bold flex items-center justify-center gap-1 transition-all " + (paymentMethod==='cash'?"bg-green-100 text-green-700 border border-green-200":"bg-gray-100 text-gray-400")}>üíµ Efectivo</button>
                                    <button onClick={function(){ setPaymentMethod('transfer'); setPayAmount(''); }} className={"py-2 rounded-lg text-sm font-bold flex items-center justify-center gap-1 transition-all " + (paymentMethod==='transfer'?"bg-indigo-100 text-indigo-700 border border-indigo-200":"bg-gray-100 text-gray-400")}>üì≤ Transf.</button>
                                </div>
                                <button onClick={function(){ setPaymentMethod('card'); setPayAmount(''); }} className={"w-full py-2 mb-4 rounded-lg text-sm font-bold flex items-center justify-center gap-1 transition-all " + (paymentMethod==='card'?"bg-orange-100 text-orange-700 border border-orange-200":"bg-gray-100 text-gray-400")}>üí≥ Tarjeta (Clip)</button>
                                {paymentMethod === 'card' && <div className="mb-4 bg-blue-50 border border-blue-100 p-3 rounded-xl flex justify-between items-center animate-fade-in"><span className="text-xs font-bold text-blue-600 uppercase">Ganancia Neta:</span><span className="text-xl font-black text-blue-800">{formatMoney(clipNet)}</span></div>}
                                <div className="flex justify-between items-end mb-3"><span className="text-sm font-bold text-gray-400">{paymentMethod === 'cash' ? 'CAMBIO:' : 'PAGO EXACTO:'}</span><span className={"text-xl font-bold " + (change<0?'text-red-500':'text-green-600')}>{paymentMethod === 'cash' ? (payAmount ? formatMoney(change) : '$0.00') : formatMoney(total)}</span></div>
                                <div className="flex gap-3 h-12"><div className={"w-1/3 bg-gray-100 rounded-xl overflow-hidden relative " + (paymentMethod !== 'cash' ? 'opacity-50' : '')}><input type="number" className="w-full h-full bg-transparent text-center font-bold text-lg outline-none text-gray-800" placeholder="Pago" value={paymentMethod !== 'cash' ? '' : payAmount} onChange={function(e){setPayAmount(e.target.value)}} disabled={paymentMethod !== 'cash'} />{paymentMethod !== 'cash' && <div className="absolute inset-0 flex items-center justify-center text-xs font-bold text-gray-400 bg-gray-100/80">Exacto</div>}</div><button onClick={handleCheckout} disabled={cart.length===0} className={"flex-1 rounded-xl font-bold text-white text-lg shadow flex items-center justify-center gap-2 active:scale-95 transition-transform " + (cart.length>0?'bg-slate-900':'bg-gray-300 cursor-not-allowed')}>COBRAR</button></div>
                            </div>
                        </div>
                    )}
                    <ProductModal isOpen={modalOpen} onClose={function(){setModalOpen(false)}} onSave={handleSave} productToEdit={productToEdit} />
                    <ConfirmModal isOpen={!!deleteData} productName={deleteData?deleteData.name:''} onClose={function(){setDeleteData(null)}} onConfirm={confirmDelete} />
                    <ReportsModal isOpen={reportsOpen} onClose={function(){setReportsOpen(false)}} onToast={setToast} />
                    <WithdrawalModal isOpen={withdrawalOpen} onClose={function(){setWithdrawalOpen(false)}} />
                    <ProfitCalculatorModal isOpen={profitCalcOpen} onClose={function(){setProfitCalcOpen(false)}} />
                </div>
            );
        };
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
